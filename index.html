<!DOCTYPE html>
<html>
<head>
  <title>Konnakol</title>
  <script src="node_modules/ohm-js/dist/ohm.js"></script>
  <script src="assets/konnakol.ohm" type="text/ohm-js"></script>
  <script src="dst/audio.js"></script>
  <script src="dst/konnakol.js"></script>
  <script src="dst/app.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }

    .button {
      border:none;
      background: #38c0ff;
      background-image: linear-gradient(to bottom, #38c0ff, #4d63f0);
      border-radius: 15px;
      font-family: Arial;
      color: #ffffff;
      font-size: 20px;
      padding: 10px 20px 10px 20px;
      text-decoration: none;
    }

    .button:hover {
      background: #3cb0fd;
      background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
      text-decoration: none;
    }

    #text {
      font-size:20px;
      line-height:30px;
    }

    .code {
      font-family: Courier;
      background: #dedede;
      padding:3px;
    }
  </style>
</head>
<body>
<h1>Konnakol</h1>

<div>
  <p>
    Syllables and phrases like 'takadimi takajuna' can be entered in the text box with the play button.
  </p>

  <p>
    You can also use the keyboard shortcut <span class="code">Command Enter</span> (Mac) <span class="code">Control Enter</span> (Windows / Linux)
  </p>

</div>

<textarea id="text" cols="80" rows="10">
g4
Takadimi Takajuna Takadimi g5 (DadiGinadom DadiGinadom)
Tom
</textarea>

<div>
  <input id="button" class="button" type="button" value="Play">

</div>

</body>
<script>
  var textarea = document.getElementById('text');
  var selectionStart = 0;
  var selectionEnd = 0;

  function updateSelection() {
    selectionStart = textarea.selectionStart;
    selectionEnd = textarea.selectionEnd;
  }

  function getContent() {
    updateSelection();
    return selectionEnd - selectionStart > 0 ?
      textarea.value.slice(selectionStart, selectionEnd) :
      textarea.value;
  }

  function play(text) {
    konnakol.play(text.replace('/konnakol', ''));
  }

  function getContentAndPlay() {
    play(getContent());
  }

  textarea.addEventListener('focusin', function (event) {
    event.target.selectionStart = selectionStart;
    event.target.selectionEnd = selectionEnd;
  });

  textarea.addEventListener('focusout', function (event) {
    updateSelection();
  });

  textarea.addEventListener('keydown', function (event) {
    if (event.key === "Enter" && event.metaKey) {
      getContentAndPlay();
    }
  });

  var button = document.getElementById('button');
  button.addEventListener('click', function (event) {
    getContentAndPlay();
  });
</script>
</html>